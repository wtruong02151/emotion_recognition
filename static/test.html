<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="webcam.js"></script>
<style type="text/css">
body {
    width: 1000px;
}

#my_camera {
    margin: auto;
    width:500px;
    height:450px;
    border-style: solid;
}

#frame {
    position: absolute;
    border-style: dotted;
    border-color: red;
    left: 350px;
    top: 75px;
    width: 306px;
    height: 306px;
    z-index: 2;
}

#middle {
    position: absolute;
    border-left: 2px dotted red;
    left: 503px;
    top: 75px;
    width: 306px;
    height: 306px;
    z-index: 2;
}

#result {
    width: 200px;
    display: block;
    margin: auto;
}

.startstop {
    background-color: #85B0BE; 
    border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 15px;
    margin: auto;
    display: block;
}
</style>
</head>

<body>
    <div class="container">
        <div id="my_camera"></div>
        <div id="frame"></div>
        <div id="middle"></div>
    </div>

    <a href="javascript:void(take_snapshot())">Take Snapshot</a>
    <div id="result"><img id="result_image" src=""></div>
    <button class="startstop">Start</button>
    <!-- <div id="my_result"></div> -->

    <script language="JavaScript">
        continueSnapping = false;

        Webcam.attach( '#my_camera' );

        Webcam.set({
            width: 506,
            height: 468,
            dest_width: 640,
            dest_height: 480,
            image_format: 'jpeg',
            jpeg_quality: 100,
            fps: 45
        });

        
        $( ".startstop" ).on('click', function() {
            $('.startstop').html(continueSnapping ? 'Stop' : 'Start')
            $('.startstop').css('background-color', continueSnapping ? '#DA2C43' : '#85B0BE')
            continueSnapping = !continueSnapping;
        });

        function take_snapshot() {
            Webcam.snap( function(data_uri) {
                document.getElementById('my_result').innerHTML = '<img src="'+data_uri+'"/>';

                data = {'data_uri': data_uri}

                // $.post("http://127.0.0.1:5000/api/conv", JSON.stringify(data), function(response, status){
                //     alert("Data: " + response + "\nStatus: " + status);
                // })

                $.ajax({
                    url: "http://127.0.0.1:5000/api/conv",
                    type: "POST",
                    data: JSON.stringify(data),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function(response, status) {
                        console.log(status.decision)
                        decision = response.results[0]
                        text = ""
                        switch(decision) {
                            case 0:
                                text = 'Happy Open Face'
                                break;
                            case 1:
                                text = 'Happy Closed Face'
                                break;
                            case 2:
                                text = 'Neutral Face'
                                break;
                            case 3:
                                text = 'Angry Face'
                                break;
                            case 4:
                                text = 'Fear Face'
                                break;
                        }
                        $("#result").html(text);
                        $("#result_image").attr("src",text+".png");
                    }
                })

            } );
        }


        setInterval(function(){ 
            if (continueSnapping) {
                take_snapshot(); 
            }
        }, 2000);
    </script>
</body>
